# wBus: A Real-Time Bus Tracking System

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](./LICENSE)
[![Next.js](https://img.shields.io/badge/Frontend-Next.js-black?logo=next.js)](./Vision)
[![Rust](https://img.shields.io/badge/Backend-Rust-orange?logo=rust)](./Polly)
[![TypeScript](https://img.shields.io/badge/Language-TypeScript-blue?logo=typescript)](./Vision)

**wBus** is a full-stack, real-time bus tracking application for Wonju, South Korea. It combines a powerful Rust-based data pipeline with a modern, interactive Next.js frontend to deliver live bus locations and schedules.

## Project Architecture

The wBus project is built on a decoupled, two-part architecture: a data pipeline and a frontend application.

1. **Polly (Data Pipeline)**: A Rust CLI that acts as the backend processor. It fetches raw route and schedule data from various public sources, cleans it, processes it, and saves it as structured, static files (JSON and GeoJSON).
2. **Vision (Frontend)**: A Next.js application that provides the user interface. It consumes the static files generated by Polly and fetches real-time bus location data from a live API to display on an interactive map.

This separation of concerns allows for a robust and scalable system. The heavy data processing is handled offline by Polly, while Vision remains lightweight and fast for the end-user.

### Data Flow

```text
                               +-----------------------------+
                               |    External Data Sources    |
                               |  (TAGO API, Wonju Website)  |
                               +-------------+---------------+
                                             |
                                             | Fetches & Processes
                                             v
+--------------------------------------------------------------------------+
|                                                                          |
|   Polly (Rust Data Pipeline)                                             |
|   - Fetches raw route and schedule data.                                 |
|   - Snaps route geometry to roads using OSRM.                            |
|   - Scrapes schedule tables.                                             |
|   - Outputs clean, static data.                                          |
|                                                                          |
+--------------------------+-----------------------------------------------+
                           |
                           | Generates Static Files
                           | (routeMap.json, snapped_routes/*.geojson, schedules/*.json)
                           v
           +-----------------------------+
           |       Static Storage        |
           | (Local folder or S3/CDN)    |
           +-------------+---------------+
                         |
                         | Loads Static Data
                         v
+------------------------+-------------------------------------------------+  +----------------------+
|                                                                          |  |   Live Data API      |
|   Vision (Next.js Frontend)                                              |  | (e.g., AWS Gateway)  |
|   - Renders interactive map and UI.                                      |  +----------+-----------+
|   - Displays routes, stops, and schedules from static data.              |             |
|   - Polls live API for real-time bus locations.                          | <-----------+
|                                                                          |   Fetches Real-Time Data
+--------------------------------------------------------------------------+
```

## Project Components

This repository contains two main packages:

### Backend: `Polly/`

The Rust-based data processing pipeline. Its sole job is to prepare all the static data needed by the frontend.

> **For detailed instructions on setup, usage, and configuration, see the [Polly README](./Polly/README.md).**

### Frontend: `Vision/`

The Next.js frontend application. This is the user-facing part of the project that displays the map and bus information.

> **For detailed instructions on setup, usage, and configuration, see the [Vision README](./Vision/README.md).**

## Full System Quick Start

To get the entire wBus system running locally, follow these steps:

### Step 1: Process Data with Polly

First, you need to run the data pipeline to generate the static assets.

1. **Navigate to the Polly directory and set it up:**

    ```bash
    cd Polly
    cp .env.example .env
    ```

    *Edit `.env` and add your `DATA_GO_KR_SERVICE_KEY`.*

2. **Run the processing commands:**

    ```bash
    # This fetches routes, snaps them to the map, and creates the route map.
    cargo run --release -- route

    # This crawls the website for schedule information.
    cargo run --release -- schedule
    ```

### Step 2: Prepare Data for Vision

Copy the generated static files from Polly's output directory to Vision's public data directory.

From the **root** of the project:

```bash
# Create the necessary directories in Vision if they don't exist
mkdir -p Vision/public/data/polylines Vision/public/data/schedules

# Copy the route map
cp Polly/storage/routeMap.json Vision/public/data/routeMap.json

# Copy the snapped route polylines (use -R for recursive)
cp -R Polly/storage/polylines/. Vision/public/data/polylines/

# Copy the schedules (use -R for recursive)
cp -R Polly/storage/schedules/. Vision/public/data/schedules/
```

### Step 3: Run the Vision Frontend

Finally, start the frontend application.

1. **Navigate to the Vision directory and set it up:**

    ```bash
    cd Vision
    cp .env.local.example .env.local
    ```

    *Edit `.env.local` to point to your live API endpoint. See the [Vision README](./Vision/README.md) for more details.*

2. **Install dependencies and run the dev server:**

    ```bash
    npm install
    npm run dev
    ```

Your local instance of wBus should now be running at `http://localhost:3000`.

## Technology Stack

- **Backend (Polly)**:
  - **Language**: Rust
  - **Core Libraries**: Tokio (Async), Reqwest (HTTP), Serde (Serialization), Scraper (HTML Parsing), Clap (CLI).

- **Frontend (Vision)**:
  - **Framework**: Next.js 15
  - **Language**: TypeScript
  - **UI**: React 19, Tailwind CSS
  - **Mapping**: React-Leaflet, MapLibre GL JS

## License

This project is licensed under the **MIT License**. See the [LICENSE](./LICENSE) file for details.
